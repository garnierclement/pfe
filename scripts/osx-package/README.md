# Creating an OS X Installer package

Create a `.pkg` installer for Mac OS X in order to provide an user friendly GUI to install Manticore.

**WARNING This a work in progress and does not work yet out of the box**

## Tree structure and entry point

The main script is `create-pkg.sh` and the tree structure of this folder is the following

* `launchd/`  
	*XML description files to register Manticore against `launchd`*
* `scripts/`  
	*`preinstall` and `postinstall` scripts for the .pkg generated by `pkgutil`*
* `resources/`  
	*resources folder used by `productbuild` and `distribution.xml` for the global package*
* `out/`  
	*temporary folder for `.pkg` files generated*
* `package/`  
	*copy of specific folders from the repository to be included in the main Manticore package for Mac OS X*

## Resources

* [Making OS X Installer Packages like a Pro] (StackOverflow)
* [Empaqueter un démon pour OS X]
* [pkgbuild man page] (Apple Developer)
* [pkgutil man page] (Apple Developer)
* [productbuild man page] (Apple Developer)
* [Creating payload-free packages with pkgbuild]
* [launchd.plist man page] (Apple Developer)
* [launchd.info]
* [brew-pkg]
* [Packages]


[Making OS X Installer Packages like a Pro]: http://stackoverflow.com/questions/11487596/making-os-x-installer-packages-like-a-pro-xcode4-developer-id-mountain-lion-re
[Empaqueter un démon pour OS X]: http://vincent.bernat.im/fr/blog/2013-autoconf-osx-installeur.html#fnref:sdk
[pkgbuild man page]: https://developer.apple.com/library/mac/documentation/Darwin/Reference/Manpages/man1/pkgbuild.1.html#//apple_ref/doc/man/1/pkgbuild
[pkgutil man page]: https://developer.apple.com/library/mac/documentation/Darwin/Reference/Manpages/man1/pkgutil.1.html
[productbuild man page]: https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/productbuild.1.html
[Creating payload-free packages with pkgbuild]: http://derflounder.wordpress.com/2012/08/15/creating-payload-free-packages-with-pkgbuild/
[launchd.plist man page]: https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man5/launchd.plist.5.html
[launchd.info]: http://launchd.info/
[brew-pkg]: https://github.com/timsutton/brew-pkg
[Packages]: http://s.sudre.free.fr/Software/Packages/about.html

## Pre and post install scripts

* `pkgbuild` looks for scripts in files called `preinstall` and `postinstall`
* You can use `set -e` to exit immediately if a command exits with a non-zero status (if applicable)
* Remember to `chmod +x` the scripts otherwise the installation will fail during the execution of the scripts (and not only `chmod u+x`)
* Use `--nopayload` to create payload-free packages with `pkgbuild` (only scripts)

## Package for dependency from Homebrew

We use [brew-pkg] to build OS X installer packages directly from Homebrew formulae.

To install [brew-pkg]

	$ brew tap timsutton/formulae
	$ brew install brew-pkg

Then to create the required packages

	$ brew pkg --with-deps zeromq
